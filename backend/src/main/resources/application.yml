# 服务器配置
server:
  port: 8080
  servlet:
    context-path: /api

# Spring配置
spring:
  application:
    name: wind-tunnel-backend
  cloud:
    nacos:
      discovery:
        server-addr: 127.0.0.1:8848  # Nacos服务器地址
    gateway:
      routes:
        - id: user-service
          uri: lb://user-service
          predicates:
            - Path=/api/users/**
          filters:
            - StripPrefix=1
  # 数据库配置
  datasource:
    url: jdbc:mysql://localhost:3306/wind_tunnel?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai
    username: root
    password: 
    driver-class-name: com.mysql.cj.jdbc.Driver
    type: com.zaxxer.hikari.HikariDataSource
    hikari:
      minimum-idle: 5
      maximum-pool-size: 15
      auto-commit: true
      idle-timeout: 30000
      pool-name: DatebookHikariCP
      max-lifetime: 1800000
      connection-timeout: 30000
      connection-test-query: SELECT 1

  # MongoDB配置
  data:
    mongodb:
      uri: mongodb://localhost:27017/wind_tunnel

  # Redis配置
  redis:
    host: localhost
    port: 6379
    password: 
    database: 0
    timeout: 2000ms
    lettuce:
      pool:
        max-active: 8
        max-idle: 8
        min-idle: 0
        max-wait: -1ms

  # RabbitMQ配置
  rabbitmq:
    host: localhost
    port: 5672
    username: guest
    password: guest
    virtual-host: /
    connection-timeout: 15000
    # 消费者配置
    listener:
      simple:
        acknowledge-mode: auto
        prefetch: 1
        concurrency: 5
        max-concurrency: 10
    # 模板配置
    template:
      retry:
        enabled: true
        initial-interval: 1000
        max-attempts: 3
        multiplier: 2

  # JPA配置
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQL8Dialect
        format_sql: true

# SpringDoc OpenAPI (Swagger) 配置
springdoc:
  api-docs:
    path: /api-docs
  swagger-ui:
    path: /swagger-ui.html
    tags-sorter: alpha
    operations-sorter: alpha
  packages-to-scan: com.windtunnel.controller
  default-consumes-media-type: application/json
  default-produces-media-type: application/json

# MyBatis-Plus配置
mybatis-plus:
  configuration:
    map-underscore-to-camel-case: true
    cache-enabled: false
    call-setters-on-nulls: true
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
  global-config:
    db-config:
      logic-delete-field: deleted  # 全局逻辑删除字段名
      logic-delete-value: 1        # 逻辑删除值
      not-delete-value: 0          # 逻辑未删除值
  mapper-locations: classpath*:/mapper/**/*.xml

# 日志配置
logging:
  level:
    com.windtunnel: debug
    org.springframework.web: debug
    org.springframework.security: debug
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
  file:
    name: logs/wind-tunnel.log

# 自定义配置
wind-tunnel:
  jwt:
    secret: windtunnel-secret-key
    expire: 86400000  # 24小时
    header: Authorization
  # TCP/IP数据采集配置
  data-collection:
    tcp:
      server-port: 9090
      max-connections: 10
      read-timeout: 30000
      write-timeout: 30000
      heartbeat-interval: 30000
      # CWT1 PC, CWT2 PC, CWT3 PC, AAWT PC, 公共动力系统PC
      hosts:
        - name: CWT1_PC
          ip: 192.168.1.101
          port: 8001
        - name: CWT2_PC
          ip: 192.168.1.102
          port: 8002
        - name: CWT3_PC
          ip: 192.168.1.103
          port: 8003
        - name: AAWT_PC
          ip: 192.168.1.104
          port: 8004
        - name: PUBLIC_POWER_SYSTEM_PC
          ip: 192.168.1.105
          port: 8005