# 智慧风洞管理系统架构设计

## 1. 系统概述

智慧风洞管理系统是一个集成化的管理平台，旨在对风洞试验的全生命周期、设备资产、安全风险、知识库及系统基础进行数字化管理。系统核心功能围绕试验流程、设备运维与数据分析展开。

## 2. 技术架构设计

### 2.1 整体架构

系统采用前后端分离的微服务架构，基于云原生设计理念，具备高可用性、高可扩展性和高安全性。

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   前端展示层     │    │   API网关       │    │   微服务层      │
│                 │    │                 │    │                 │
│  Vue.js/React   │◄──►│   Nginx/Kong    │◄──►│  试验管理服务    │
│  Element/Ant    │    │                 │    │                 │
│  移动端/H5      │    │                 │    │  设备管理服务    │
│  大屏展示       │    │                 │    │                 │
│                 │    │                 │    │  安全管理服务    │
└─────────────────┘    └─────────────────┘    │                 │
                                            │  知识库服务      │
┌─────────────────┐    ┌─────────────────┐    │                 │
│   数据存储层     │    │   消息中间件     │    │  系统管理服务    │
│                 │    │                 │    │                 │
│   MySQL         │    │   RabbitMQ      │    └─────────────────┘
│   MongoDB       │    │   Redis         │
│   Redis         │    │   Kafka         │    ┌─────────────────┐
└─────────────────┘    └─────────────────┘    │   基础设施层     │
                                            │                 │
┌─────────────────┐    ┌─────────────────┐    │  Docker/K8s     │
│   监控运维层     │    │   第三方集成     │    │  Jenkins       │
│                 │    │                 │    │  Prometheus     │
│   Prometheus    │    │   短信服务      │    │  Grafana       │
│   Grafana       │    │   邮件服务      │    │  ELK Stack     │
│   ELK Stack     │    │   TCP/IP接口    │    └─────────────────┘
└─────────────────┘    └─────────────────┘
```

### 2.2 前端架构

- **框架**: Vue.js 3.x + TypeScript 或 React 18 + TypeScript
- **UI组件库**: Element Plus / Ant Design Vue 或 Ant Design
- **状态管理**: Pinia / Vuex 或 Redux / Zustand
- **路由管理**: Vue Router 或 React Router
- **HTTP客户端**: Axios
- **数据可视化**: ECharts / D3.js / Chart.js
- **实时通信**: WebSocket / Socket.io
- **构建工具**: Vite / Webpack
- **UI组件**: 集成日历组件（适配中国日历）、表格、图表、表单等

### 2.3 后端架构

#### 2.3.1 技术栈
- **基础框架**: Spring Boot 3.x + Spring Cloud 2022
- **编程语言**: Java 17+
- **微服务治理**: Spring Cloud Gateway, OpenFeign, Nacos/Eureka
- **安全框架**: Spring Security + JWT + OAuth2
- **持久层**: MyBatis Plus / JPA
- **缓存**: Redis 7.x
- **消息队列**: RabbitMQ / Apache Kafka
- **定时任务**: XXL-Job / Quartz
- **API文档**: Swagger / OpenAPI 3.0

#### 2.3.2 微服务拆分
1. **用户认证服务 (Auth Service)**
   - 用户登录/登出
   - JWT令牌管理
   - 单点登录（预留接口）

2. **试验管理服务 (Experiment Service)**
   - 试验申请与审批
   - 试验排期管理
   - 试验数据采集
   - 成本管控
   - 试验报告管理

3. **设备管理服务 (Equipment Service)**
   - 设备信息管理
   - 维护计划管理
   - 维修管理
   - 健康状态监测
   - 校准管理

4. **安全管理服务 (Security Service)**
   - 风险台账管理
   - 隐患排查记录

5. **知识库服务 (Knowledge Service)**
   - 知识上传/更新
   - 知识查询

6. **系统管理服务 (System Service)**
   - 用户管理
   - 权限配置
   - 站内信
   - 操作日志
   - 系统日志
   - 基础参数配置

7. **通知服务 (Notification Service)**
   - 站内信发送
   - 邮件通知
   - 短信通知

8. **数据采集服务 (Data Collection Service)**
   - TCP/IP接口数据采集
   - 实时数据处理
   - 数据验证与清洗

### 2.4 数据架构

#### 2.4.1 数据库选型
- **关系型数据库**: MySQL 8.0
  - 存储用户信息、组织架构、试验项目、设备台账等结构化数据
  - 支持事务处理，保证数据一致性

- **文档数据库**: MongoDB 6.0
  - 存储实时采集数据、历史数据、日志数据
  - 支持大容量数据存储和高并发读写
  - 数据保留周期可参考10年

- **缓存数据库**: Redis 7.0
  - 缓存热点数据，提高系统响应速度
  - 存储会话信息、权限信息
  - 实现分布式锁

#### 2.4.2 数据存储策略
- 实时数据：MongoDB（支持10年数据保留）
- 试验管理数据：MySQL/MongoDB混合模式
- 文件存储：支持.txt、.csv、.md、.json、.doc、.docx、.pdf等格式，单个文件最大200MB
- 操作日志：MongoDB（支持按时间/类型检索）

### 2.5 接口架构

#### 2.5.1 内部服务接口
- RESTful API + JSON
- gRPC（高性能服务间通信）
- 消息队列（异步通信）

#### 2.5.2 外部接口
- TCP/IP接口（用于CWT1 PC、CWT2 PC、CWT3 PC、AAWT PC、公共动力系统PC数据采集）
- HTTP/HTTPS API（第三方系统集成）
- WebSocket（实时数据推送）

### 2.6 安全架构

- **身份认证**: JWT + OAuth2
- **权限控制**: 基于RBAC模型的细粒度权限控制（支持到实验室级别）
- **数据加密**: 敏感数据AES加密存储
- **传输安全**: HTTPS + TLS 1.3
- **访问控制**: IP白名单、API限流
- **审计日志**: 完整的操作日志记录

### 2.7 部署架构

#### 2.7.1 容器化部署
- **容器技术**: Docker
- **容器编排**: Kubernetes (K8s)
- **服务网格**: Istio（可选）

#### 2.7.2 CI/CD流水线
- **代码仓库**: Git
- **持续集成**: Jenkins / GitLab CI
- **镜像仓库**: Harbor / Docker Registry
- **自动化部署**: Helm Charts

#### 2.7.3 负载均衡
- **反向代理**: Nginx
- **API网关**: Spring Cloud Gateway / Kong
- **服务发现**: Nacos / Eureka

### 2.8 监控架构

- **应用监控**: Prometheus + Grafana
- **日志收集**: ELK Stack (Elasticsearch, Logstash, Kibana)
- **链路追踪**: Jaeger / Zipkin
- **告警系统**: AlertManager
- **健康检查**: Actuator + 自定义健康检查

## 3. 性能与扩展性

### 3.1 性能指标
- 支持100用户并发访问
- 页面响应时间 < 2秒
- API响应时间 < 500毫秒
- 数据库查询时间 < 200毫秒

### 3.2 扩展性设计
- 微服务架构支持水平扩展
- 数据库读写分离
- Redis集群部署
- 消息队列集群部署

## 4. 开发与运维规范

### 4.1 开发规范
- 代码规范：遵循阿里巴巴Java开发手册
- Git工作流：Git Flow
- 代码审查：Pull Request机制
- 文档规范：API文档、数据库设计文档

### 4.2 运维规范
- 容器化部署
- 自动化监控告警
- 定期备份策略
- 灰度发布机制