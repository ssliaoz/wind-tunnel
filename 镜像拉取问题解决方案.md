# 解决Docker镜像拉取403错误指南

## 问题描述

当您遇到以下错误时：
```
Error response from daemon: unknown: failed to resolve reference "docker.io/library/mysql:8.0": unexpected status from HEAD request to https://60xxgwgy.mirror.aliyuncs.com/v2/library/mysql/manifests/8.0?ns=docker.io: 403 Forbidden
```

这表明Docker配置中的镜像加速器存在问题。

## 解决方案

### 1. 修复Docker配置

首先，需要修复Docker的配置文件，移除有问题的镜像加速器地址：

1. 打开 Docker Desktop 设置
2. 选择 Docker Engine 选项卡
3. 将以下配置替换现有内容：

```json
{
  "debug": false,
  "experimental": false,
  "insecure-registries": [],
  "registry-mirrors": [
    "https://hub-mirror.c.163.com",
    "https://mirror.baidubce.com",
    "https://docker.mirrors.ustc.edu.cn"
  ]
}
```

4. 点击 "Apply & Restart" 重启 Docker

### 2. 使用官方镜像配置

本项目提供了多种配置文件，按优先级排列：

1. `docker-compose-official.yml` - 使用官方镜像源
2. `docker-compose-raw.yml` - 不使用镜像加速器
3. `docker-compose-cn.yml` - 使用国内镜像加速器
4. `docker-compose.yml` - 默认配置

### 3. 启动服务

修复配置后，使用以下命令启动服务：

```bash
# 使用官方镜像配置启动
./start.sh
```

或使用简化版启动脚本：

```bash
./start-simple.sh
```

### 4. 清理和重试

如果仍然遇到问题，可以使用清理脚本：

```bash
./clean-and-retry.sh
```

然后再次尝试启动服务。

### 5. 故障排除

如果问题持续存在：

1. 检查网络连接
2. 确保防火墙没有阻止Docker访问
3. 尝试手动拉取镜像：
   ```bash
   docker pull mysql:8.0
   docker pull mongo:5.0
   docker pull redis:7.0-alpine
   docker pull rabbitmq:3.11-management
   docker pull nacos/nacos-server:v2.2.3
   ```

## 项目结构

本项目包含以下Docker相关文件：

- `Dockerfile` - 应用程序的Docker构建文件
- `Dockerfile-official` - 使用官方镜像源的Docker构建文件
- `docker-compose.yml` - 默认Docker Compose配置
- `docker-compose-official.yml` - 使用官方镜像源的Compose配置
- `docker-compose-raw.yml` - 不使用镜像加速器的Compose配置
- `docker-compose-cn.yml` - 使用国内镜像加速器的Compose配置
- `start.sh` - 主启动脚本
- `start-simple.sh` - 简化版启动脚本
- `stop.sh` - 停止脚本
- `clean-and-retry.sh` - 清理和重试脚本
- `fix-mirror-config.sh` - 修复镜像配置脚本

## 访问服务

服务启动后，可以通过以下地址访问：

- 应用服务：http://localhost:8080
- API文档：http://localhost:8080/swagger-ui.html
- RabbitMQ管理界面：http://localhost:15672 (用户名: guest, 密码: guest)
- Nacos管理界面：http://localhost:8848 (用户名: nacos, 密码: nacos)

## 停止服务

要停止所有服务，运行：
```bash
./stop.sh
```